<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
    <title></title>
	<script src="Bmob-2.0.0.min.js"></script>
	<script src="jq_300.js"></script>
	<script src="vue.js"></script>
    <style>
		pre{
			white-space: pre-wrap; /*css-3*/ 
			white-space: -moz-pre-wrap; /*Mozilla,since1999*/ 
			white-space: -pre-wrap; /*Opera4-6*/ 
			white-space: -o-pre-wrap; /*Opera7*/ 
			word-wrap: break-word; /*InternetExplorer5.5+*/ 
		}
    </style>
</head>
<body>

<a href="edit.html">添加</a>

<div id="app">
	<button @click="delete_data">删除最后一行数据</button>
	<div v-for="(elem,i) of all_data" :key="i">
	<h1>
		<div><span>{{elem.table_title}}</div>
		<div><span @click="jump_to_edit">编辑</span><span>删除</span></div>
	</h1>
	<pre>{{elem.table_content}}</pre>
  </div>
</div>

<script>
Bmob.initialize("ed9249ec8fffb13f", "121212");
var data={
  t_title:"",
  t_content:"",
  all_data:[]
};
//3. 创建VUE对象，将界面和数据包裹起来
new Vue({//至少两个成员
  el:"#app",//找到界面div
  data,//data:data//将数据装入VUE
  mounted(){
		this.get_table();
},
  
  methods:{          /*methods--------start*/
  	  /*------------------*/
		jump_to_edit(){
            url = "edit_new.html?t_title="+123+"&t_content="+456;//此处拼接内容
            window.location.href = url;
        },
	  /*-----------------*/
	  get_table(){
	    var This=this;
		console.log("查询");
            const query = Bmob.Query("table_1");
			query.find().then(res => {
				console.log(res)
				This.all_data=res;
		});
	  },
	  /*-----------------*/
	  add_data(){
		var This=this;
		const query = Bmob.Query('table_1');
		if(This.t_title!=""&&This.t_content!=""){
			query.set("table_title",This.t_title)
			query.set("table_content",This.t_content)
			query.save().then(res => {
			  console.log(res);
			  This.get_table();
			}).catch(err => {
			  console.log(err)
			})
		}
	  },
	  /*-----------------*/
	  delete_data(){
		console.log("删除");
		var This=this;
		const query = Bmob.Query('table_1');
		query.find().then(res => { 
			console.log("执行成功");
			console.log(res);
			query.destroy(res[res.length-1].objectId).then(res => {
			  console.log(res);
			  This.get_table();
			}).catch(err => {
			  console.log(err)
			});
		});
	  }
	  /*-----------------*/
	  
    
  }  /*methods--------end*/
})

        
		
</script>
</body>
</html>

